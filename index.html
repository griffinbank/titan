<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='//fonts.googleapis.com/css?family=Montserrat:700|Open+Sans:300' rel='stylesheet' type='text/css'>
    <title>Titan Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #303030;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all_nosearch.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <!-- 
        <img src="images/logo.png" alt="Logo" />
      -->
        <div class="lang-selector">
        </div>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="titan">Titan</h1>

<p>Titan is a simple and extensible framework for building Clojure web
applications. Whether you&rsquo;re new to Clojure or an experienced Clojurist, Titan
can help you develop quickly and with delight.</p>

<h2 id="introduction">Introduction</h2>

<p>Titan is a Clojure web application framework with a focus on simplicity,
extensibilty, and productivity. Titan is designed to make development easy,
straightforward, and fun.</p>

<p><em>Titan is guided by the following core principles:</em></p>

<ul>
<li>Simple is better than complex</li>
<li>Clarity is better than cleverness</li>
<li>Build for extension: everything should compose.</li>
</ul>

<h4 id="a-quick-note-on-the-documentation">A Quick Note on the Documentation</h4>

<p>The code examples included in this documentation are oriented around the
creation of a hypothetical blog application. The complete source code for this
demonstration application can be found <a href="https://github.com/venantius/titan/tree/master/example">here</a>.</p>

<h2 id="getting-started">Getting Started</h2>

<p>It&rsquo;s easy to get started with Titan, whether you&rsquo;re starting
from scratch or modifying an existing application.</p>

<h3 id="beginning-from-scratch">Beginning From Scratch</h3>

<aside class="warning">This feature is not yet complete.</aside>

<p>To create a new application using the Titan Leiningen template, just run <code class="prettyprint">lein new titan-app $your_app_name</code>. This will create a version of the example blog application that uses
the provided application name instead of <code class="prettyprint">example</code>.</p>

<h3 id="adding-titan-to-an-existing-app">Adding Titan to an Existing App</h3>

<p>Adding Titan to an existing application is fairly straighforward, but for
obvious reasons involves a few more steps than starting from a clean slate.</p>

<h4 id="configure-your-project-clj">Configure your <code class="prettyprint">project.clj</code></h4>
<pre class="highlight clojure"><code><span class="no">:dependencies</span><span class="w"> </span><span class="p">[[</span><span class="n">titan</span><span class="w"> </span><span class="s">"0.0.1-alpha1"</span><span class="p">]</span><span class="w">
               </span><span class="c1">; ...
</span></code></pre>

<p>First, add Titan to your list of dependencies.</p>
<pre class="highlight clojure"><code><span class="w">               </span><span class="p">[</span><span class="n">org.postgresql/postgresql</span><span class="w"> </span><span class="s">"9.4-1206-jdbc42"</span><span class="p">]</span><span class="w">
               </span><span class="c1">; ...
</span></code></pre>

<p>If you&rsquo;re currently using a SQL database for your application, make sure to
include the appropriate JDBC driver in your dependencies. The example code
includes a fairly recent version of the PostgreSQL JDBC driver.</p>
<pre class="highlight clojure"><code><span class="w">               </span><span class="p">[</span><span class="n">compojure</span><span class="w"> </span><span class="s">"1.5.0"</span><span class="p">]</span><span class="w">
               </span><span class="c1">;; etc...
</span><span class="w">               </span><span class="p">]</span><span class="w">
</span></code></pre>

<p>Titan doesn&rsquo;t include its own routing engine, so you&rsquo;ll want to make sure you
have the appropriate dependency included for that as well. In our example code
you&rsquo;ll find a dependency for
<a href="https://github.com/weavejester/compojure">Compojure</a>,
the popular routing library, but you can use whatever routing library you
prefer.</p>
<pre class="highlight clojure"><code><span class="no">:aliases</span><span class="w"> </span><span class="p">{</span><span class="s">"migrate"</span><span class="w">  </span><span class="p">[</span><span class="s">"run"</span><span class="w"> </span><span class="s">"-m"</span><span class="w"> </span><span class="s">"titan.db.migrations/migrate"</span><span class="p">]</span><span class="w">
          </span><span class="s">"rollback"</span><span class="w"> </span><span class="p">[</span><span class="s">"run"</span><span class="w"> </span><span class="s">"-m"</span><span class="w"> </span><span class="s">"titan.db.migrations/rollback"</span><span class="p">]}</span><span class="w">
</span></code></pre>

<p>We also recommend adding some aliases to your <code class="prettyprint">project.clj</code> to make
command-line migrations more convenient.</p>

<h4 id="configuring-your-application-code">Configuring Your Application Code</h4>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">example.core</span><span class="w">
  </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">compojure.core</span><span class="w"> </span><span class="no">:refer</span><span class="w"> </span><span class="no">:all</span><span class="p">]</span><span class="w">
            </span><span class="p">[</span><span class="n">compojure.route</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">route</span><span class="p">]</span><span class="w">
            </span><span class="p">[</span><span class="n">titan.app</span><span class="w"> </span><span class="no">:refer</span><span class="w"> </span><span class="p">[</span><span class="n">defapp</span><span class="p">]]</span><span class="w">
            </span><span class="p">[</span><span class="n">titan.server</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">server</span><span class="p">]))</span><span class="w">

</span><span class="p">(</span><span class="nf">defroutes</span><span class="w"> </span><span class="n">app-routes</span><span class="w">
  </span><span class="p">(</span><span class="nf">GET</span><span class="w"> </span><span class="s">"/"</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="no">:status</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="no">:body</span><span class="w"> </span><span class="s">"&lt;h1&gt;Hello World!&lt;/h1&gt;"</span><span class="p">})</span><span class="w">
  </span><span class="p">(</span><span class="nf">route/not-found</span><span class="w"> </span><span class="s">"Beep boop not found"</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="nf">defapp</span><span class="w"> </span><span class="n">app-routes</span><span class="p">)</span><span class="w">
</span></code></pre>

<p>Titan expects you to wrap your application&rsquo;s main handler in the <code class="prettyprint">defapp</code> macro,
located in the <code class="prettyprint">titan.app</code> namespace. The <code class="prettyprint">defapp</code> macro is used to store
your primary application handler in the <code class="prettyprint">titan.app/app</code> atom, which allows
Titan to know where to find it without having to know the details of your
your application structure. Re-loading the namespace including the <code class="prettyprint">defapp</code>
macro will reset the <code class="prettyprint">app</code> atom&rsquo;s contents.</p>

<h4 id="starting-the-titan-server">Starting the Titan server</h4>

<p>To start the Titan server, you</p>

<aside class="warning">I haven&rsquo;t written this documentation yet</aside>

<h1 id="database">Database</h1>

<p>Titan assumes the use of a SQL-powered relational database, and provides
a drop-in solution for simple database query patterns. Titan also provides a
straightforward, pure SQL solution for migrations.</p>

<p>Under the hood, Titan is powered by <a href="https://github.com/korma/korma">Korma</a> and
<a href="https://github.com/weavejester/ragtime">Ragtime</a>.</p>

<h2 id="migrations">Migrations</h2>

<p>Database migrations for a Titan application should be written in pure SQL and
stored in individual files in your project&rsquo;s <code class="prettyprint">resources/migrations</code> directory.
Each migration should have one file for the up migration and a corresponding
file for the down migration.</p>

<p>Up migration files should use the <code class="prettyprint">.up.sql</code> extension, while down migration
files should use <code class="prettyprint">down.sql.</code> Migration filenames should be unique and ordered -
in general, using the current time (down to the second) is a good practice for
generating an ordering prefix.</p>

<aside class="notice">
On OS X, you can get the current time with <code>date -u +"%Y%m%d%H%M%S"</code>
</aside>

<h3 id="writing-migrations">Writing Migrations</h3>
<pre class="highlight sql"><code><span class="cm">/*20160601062426_initial.up.sql*/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">author</span> <span class="p">(</span>
  <span class="n">id</span>       <span class="n">SERIAL</span>  <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="n">username</span> <span class="n">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">password</span> <span class="n">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
<span class="c1">-- ;;
</span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">blog</span> <span class="p">(</span>
  <span class="n">id</span>    <span class="n">SERIAL</span>  <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="n">title</span> <span class="n">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
<span class="c1">-- ;;
</span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">post</span> <span class="p">(</span>
  <span class="n">id</span>        <span class="n">SERIAL</span>  <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="n">author_id</span> <span class="n">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">REFERENCES</span> <span class="n">author</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span><span class="p">,</span>
  <span class="n">blog_id</span>   <span class="n">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">REFERENCES</span> <span class="n">blog</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span><span class="p">,</span>
  <span class="n">content</span>   <span class="n">TEXT</span>    <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
</code></pre>

<p>Let&rsquo;s consider our example blog application. The initial migration, creating the
relevant tables, might look like the code on the right. In this migration, we&rsquo;re
creating three tables: one for authors, one for blogs, and one for blog posts.</p>

<hr>
<pre class="highlight sql"><code><span class="cm">/*20160601062426_initial.down.sql*/</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">post</span><span class="p">;</span>
<span class="c1">--;;
</span><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">blog</span><span class="p">;</span>
<span class="c1">--;;
</span><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">author</span><span class="p">;;</span>
</code></pre>

<p>A corresponding down migration might look like the attached code sample.</p>

<h3 id="running-migrations">Running Migrations</h3>

<aside class="warning">
This is a feature with an actively changing API.
</aside>

<h4 id="running-migrations-at-the-command-line">Running Migrations at the Command Line</h4>

<p>To apply migrations at the command line, run <code class="prettyprint">lein migrate</code>. If
you want to roll back all prior migrations, use <code class="prettyprint">lein rollback</code>.</p>

<p>Titan AOT-compiles migration classes, enabling you to run migrations using an
Uberjar as part of your deployment process as well. Running migrations this way
can be done by executing <code class="prettyprint">java -cp path/to/app.jar titan.commands.db.migrate</code>.</p>

<h4 id="running-migrations-at-the-repl">Running Migrations at the REPL</h4>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="ss">'titan.db.migrations</span><span class="p">)</span><span class="w">
</span><span class="p">(</span><span class="nf">titan.db.migrations/migrate</span><span class="p">)</span><span class="w">
</span></code></pre>

<p>To apply migrations from the REPL, first require the Titan database migrations
namespace, then run the <code class="prettyprint">migrate</code> command. You can also roll migrations back
with <code class="prettyprint">rollback</code>.</p>

<h2 id="models">Models</h2>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">example.model</span><span class="w">
  </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">korma.core</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">k</span><span class="p">]))</span><span class="w">

</span><span class="p">(</span><span class="nf">k/defentity</span><span class="w"> </span><span class="n">app-user</span><span class="w">
  </span><span class="p">(</span><span class="nf">k/table</span><span class="w"> </span><span class="no">:app_user</span><span class="p">))</span><span class="w">
</span></code></pre>

<p>Titan provides a SQL query DSL that wraps <a href="https://github.com/korma/korma">Korma</a>
for runtime query generation and execution. This DSL represents an explicit
subset of Korma&rsquo;s functionality with a specific focus on composable functions
and delayed execution.</p>

<aside class="warning">This documentation is incomplete</aside>

<p>The expected usage pattern for a Titan query is composition followed by
dereference. This patterns is</p>

<p>You should define all of your Korma entities in a single namespace
and then store per-model logic in individual namespaces. By convention,
entities should be declared in <code class="prettyprint">$yourapp.model</code> and individual models should be
declared in <code class="prettyprint">$yourapp.model.$model_name</code>.</p>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">example.model.app-user</span><span class="w">
  </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">titan.model</span><span class="w"> </span><span class="no">:as</span><span class="w"> </span><span class="n">m</span><span class="p">]))</span><span class="w">
</span></code></pre>

<h3 id="fetch">Fetch</h3>
<pre class="highlight clojure"><code><span class="c1">;; SELECT * FROM app_user;
</span><span class="err">@</span><span class="p">(</span><span class="nf">m/fetch</span><span class="w"> </span><span class="n">app-user</span><span class="p">)</span><span class="w">
</span><span class="n">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="no">:id</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="no">:name</span><span class="w"> </span><span class="s">"Venantius"</span><span class="p">}</span><span class="n">,</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="no">:name</span><span class="w"> </span><span class="s">"Test User"</span><span class="p">})</span><span class="w">

</span><span class="c1">;; SELECT * FROM app_user WHERE id = 2;
</span><span class="err">@</span><span class="p">(</span><span class="nf">m/fetch</span><span class="w"> </span><span class="n">app-user</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="mi">2</span><span class="p">})</span><span class="w">
</span><span class="n">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="no">:id</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="no">:name</span><span class="w"> </span><span class="s">"Test User"</span><span class="p">})</span><span class="w">

</span><span class="c1">;; SELECT * FROM app_user LIMIT 1
</span><span class="err">@</span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">m/fetch</span><span class="w"> </span><span class="n">app-user</span><span class="p">)</span><span class="w">
     </span><span class="p">(</span><span class="nf">m/limit</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w">
</span><span class="n">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="no">:id</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="no">:name</span><span class="w"> </span><span class="s">"Test User"</span><span class="p">})</span><span class="w">
</span></code></pre>

<p>Fetch records for a model with <code class="prettyprint">fetch</code>.</p>

<p>You can fetch all records where a map of parameters matches by passing that in as well.</p>

<h3 id="fetch-one">Fetch-one</h3>
<pre class="highlight clojure"><code><span class="c1">;; SELECT * FROM app_user WHERE id = 2 LIMIT 1;
</span><span class="p">(</span><span class="nf">fetch-one-app-user</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="mi">2</span><span class="p">})</span><span class="w">
</span><span class="c1">;; =&gt; {:id 2 :name "Test User"}
</span></code></pre>

<p>If you just want to fetch a single record from the database, use <code class="prettyprint">fetch-one</code>.</p>

<aside class="notice">
Note that you&rsquo;ll get a single map back from <code>fetch-one</code>, not a seq.
</aside>

<h3 id="create">Create</h3>
<pre class="highlight clojure"><code><span class="c1">;; INSERT INTO app_user (name) VALUES ('Bear');
</span><span class="p">(</span><span class="nf">create-app-user!</span><span class="w"> </span><span class="p">{</span><span class="no">:name</span><span class="w"> </span><span class="s">"Bear"</span><span class="p">})</span><span class="w">
</span><span class="c1">;; =&gt; {:id 3 :name "Bear"}
</span></code></pre>

<p>Insert a new record into the database with <code class="prettyprint">create</code>. Returns the inserted
record.</p>

<h3 id="update">Update</h3>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">update-app-user!</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">{</span><span class="no">:name</span><span class="w"> </span><span class="s">"Ursa Americanus Kermodei"</span><span class="p">})</span><span class="w">
</span><span class="c1">;; =&gt; {:id 3 :name "Ursa Americanus Kermodei"}
</span></code></pre>

<p>Update the record with a given id to have the provided new fields. Returns the
updated record.</p>

<h3 id="delete">Delete</h3>
<pre class="highlight clojure"><code><span class="c1">;; DELETE FROM app_user WHERE id = 3;
</span><span class="p">(</span><span class="nf">delete-app-user!</span><span class="w"> </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="mi">3</span><span class="p">})</span><span class="w">
</span><span class="c1">;; =&gt; 1 ;; returns the number of records deleted
</span></code></pre>

<p>Deletes all records matching the provided parameters. Returns the number of records
deleted.</p>

<h1 id="controllers">Controllers</h1>

<p>Controllers are defined with <code class="prettyprint">titan.controller/defcontroller</code>.</p>

<p>Let&rsquo;s say you have a schema named <code class="prettyprint">repo</code>:</p>
<pre class="highlight clojure"><code><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">repo</span><span class="w">
  </span><span class="p">{</span><span class="no">:id</span><span class="w"> </span><span class="n">s/Int</span><span class="w">
   </span><span class="no">:full_name</span><span class="w"> </span><span class="n">s/Str</span><span class="w">
   </span><span class="no">:name</span><span class="w"> </span><span class="n">s/Str</span><span class="w">
   </span><span class="no">:owner</span><span class="w"> </span><span class="n">owner</span><span class="w">
   </span><span class="no">:private</span><span class="w"> </span><span class="n">s/Bool</span><span class="w">
   </span><span class="no">:fork</span><span class="w"> </span><span class="n">s/Bool</span><span class="p">})</span><span class="w">
</span></code></pre>

<p>Now you can define a controller in which <code class="prettyprint">:params</code> must be coerced into the <code class="prettyprint">repo</code>
schema as follows:</p>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">defcontroller</span><span class="w"> </span><span class="n">create!</span><span class="w">
  </span><span class="s">"Follow a new repository."</span><span class="w">
  </span><span class="p">{</span><span class="no">:params</span><span class="w"> </span><span class="n">repo</span><span class="p">}</span><span class="w">
  </span><span class="p">[{</span><span class="no">:keys</span><span class="w"> </span><span class="p">[</span><span class="n">params</span><span class="w"> </span><span class="n">user</span><span class="p">]}]</span><span class="w">
  </span><span class="p">(</span><span class="nf">behavior</span><span class="w"> </span><span class="n">...</span><span class="p">))</span><span class="w">
</span></code></pre>

<h1 id="about">About</h1>

<p>Titan and any associated documentation is Copyright Â© 2016 W. David Jarvis</p>

<p>Titan is distributed under the Eclipse Public License version 1.0.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
          </div>
      </div>
    </div>
  </body>
</html>
